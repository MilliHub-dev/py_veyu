{% extends "admin/change_list.html" %}
{% load static %}

{% block content %}
<!-- Stats Boxes -->
<div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">
    {% for stat in metrics.items %}
    <div style="flex: 1; min-width: 200px; max-width: 250px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
        <h3>{{ stat.0 }}</h3>
        <p style="font-size: 24px; font-weight: bold; color: #2563eb;">{{ stat.1 }}</p>
    </div>
    {% endfor %}
</div>

<!-- Charts Section -->
<div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">
    <div style="flex: 1; min-width: 400px; max-width: 600px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>User Growth</h3>
        <div style="position: relative; height: 300px; width: 100%;">
            <canvas id="userChart"></canvas>
        </div>
    </div>
    <div style="flex: 1; min-width: 400px; max-width: 600px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>Orders & Revenue</h3>
        <div style="position: relative; height: 300px; width: 100%;">
            <canvas id="revenueChart"></canvas>
        </div>
    </div>
</div>

<!-- Default Django Change List Content -->
{{ block.super }}
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Ensure data is available to avoid errors
    const labels = {{ monthly_data.labels|default:"[]"|safe }};
    const customers = {{ monthly_data.customers|default:"[]"|safe }};
    const dealers = {{ monthly_data.dealers|default:"[]"|safe }};
    const mechanics = {{ monthly_data.mechanics|default:"[]"|safe }};
    const orders = {{ monthly_data.orders|default:"[]"|safe }};
    const revenue = {{ monthly_data.revenue|default:"[]"|safe }};

    // User Growth Chart
    new Chart(document.getElementById('userChart').getContext('2d'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                { label: 'Customers', data: customers, borderColor: '#2563eb', fill: false },
                { label: 'Dealers', data: dealers, borderColor: '#16a34a', fill: false },
                { label: 'Mechanics', data: mechanics, borderColor: '#ea580c', fill: false }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                tooltip: { mode: 'index', intersect: false }
            }
        }
    });

    // Revenue Chart
    new Chart(document.getElementById('revenueChart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                { label: 'Orders', data: orders, backgroundColor: '#ea580c', yAxisID: 'y-axis-1' },
                { label: 'Revenue', data: revenue, backgroundColor: '#dc2626', yAxisID: 'y-axis-2', type: 'line' }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                'y-axis-1': { position: 'left', beginAtZero: true, title: { display: true, text: 'Number of Orders' } },
                'y-axis-2': { position: 'right', beginAtZero: true, title: { display: true, text: 'Revenue ($)' } }
            }
        }
    });
});
</script>
{% endblock %}
