{% extends "admin/change_list.html" %}
{% load static %}

{% block content %}
<!-- Stats boxes -->
<div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
    <div style="flex: 1; min-width: 200px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>Total Customers</h3>
        <p style="font-size: 24px; font-weight: bold; color: #2563eb;">{{ metrics.total_customers|floatformat:0 }}</p>
    </div>
    <div style="flex: 1; min-width: 200px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>Total Dealers</h3>
        <p style="font-size: 24px; font-weight: bold; color: #16a34a;">{{ metrics.total_dealers|floatformat:0 }}</p>
    </div>
    <div style="flex: 1; min-width: 200px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>Total Orders</h3>
        <p style="font-size: 24px; font-weight: bold; color: #ea580c;">{{ metrics.total_orders|floatformat:0 }}</p>
    </div>
    <div style="flex: 1; min-width: 200px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>Total Revenue</h3>
        <p style="font-size: 24px; font-weight: bold; color: #dc2626;">${{ metrics.total_revenue|floatformat:2 }}</p>
    </div>
</div>

<!-- Charts -->
<div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
    <div style="flex: 1; min-width: 400px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>User Growth</h3>
        <canvas id="userChart" height="300"></canvas>
    </div>
    <div style="flex: 1; min-width: 400px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3>Orders & Revenue</h3>
        <canvas id="revenueChart" height="300"></canvas>
    </div>
</div>

<!-- Original change list -->
{{ block.super }}

{% endblock %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // User Growth Chart
    new Chart(document.getElementById('userChart'), {
        type: 'line',
        data: {
            labels: {{ monthly_data.labels|safe }},
            datasets: [{
                label: 'Customers',
                data: {{ monthly_data.customers|safe }},
                borderColor: '#2563eb',
                fill: false
            }, {
                label: 'Dealers',
                data: {{ monthly_data.dealers|safe }},
                borderColor: '#16a34a',
                fill: false
            }, {
                label: 'Mechanics',
                data: {{ monthly_data.mechanics|safe }},
                borderColor: '#ea580c',
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    mode: 'index',
                    intersect: false
                }
            }
        }
    });

    // Revenue Chart
    new Chart(document.getElementById('revenueChart'), {
        type: 'bar',
        data: {
            labels: {{ monthly_data.labels|safe }},
            datasets: [{
                label: 'Orders',
                data: {{ monthly_data.orders|safe }},
                backgroundColor: '#ea580c',
                yAxisID: 'y-axis-1'
            }, {
                label: 'Revenue',
                data: {{ monthly_data.revenue|safe }},
                backgroundColor: '#dc2626',
                yAxisID: 'y-axis-2',
                type: 'line'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false
            },
            scales: {
                'y-axis-1': {
                    position: 'left',
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Orders'
                    }
                },
                'y-axis-2': {
                    position: 'right',
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Revenue ($)'
                    }
                }
            }
        }
    });
});
</script>
{% endblock %}